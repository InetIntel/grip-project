#  This software is Copyright (c) 2015 The Regents of the University of
#  California. All Rights Reserved. Permission to copy, modify, and distribute this
#  software and its documentation for academic research and education purposes,
#  without fee, and without a written agreement is hereby granted, provided that
#  the above copyright notice, this paragraph and the following three paragraphs
#  appear in all copies. Permission to make use of this software for other than
#  academic research and education purposes may be obtained by contacting:
#
#  Office of Innovation and Commercialization
#  9500 Gilman Drive, Mail Code 0910
#  University of California
#  La Jolla, CA 92093-0910
#  (858) 534-5815
#  invent@ucsd.edu
#
#  This software program and documentation are copyrighted by The Regents of the
#  University of California. The software program and documentation are supplied
#  "as is", without any accompanying services from The Regents. The Regents does
#  not warrant that the operation of the program will be uninterrupted or
#  error-free. The end-user understands that the program was developed for research
#  purposes and is advised not to rely exclusively on the program for any reason.
#
#  IN NO EVENT SHALL THE UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR
#  DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST
#  PROFITS, ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
#  THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
#  DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
#  FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE PROVIDED HEREUNDER IS ON AN "AS
#  IS" BASIS, AND THE UNIVERSITY OF CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE
#  MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
import sys
from unittest import TestCase

from grip.utils.bgp import *


class Test(TestCase):
    def test_find_common_hops(self):
        self.assertEqual(find_common_hops([[1, 2, 3]]), [1, 2, 3])
        self.assertEqual(find_common_hops([[1, 2, 3], [2, 3]]), [2, 3])
        self.assertEqual(find_common_hops([[1, 2, 3], [2, 3], [3]]), [3])

        # lastly, make sure the original input is not altered
        lst = [[1, 2, 3], [2, 3], [3]]
        find_common_hops(lst)
        self.assertEqual(lst, [[1, 2, 3], [2, 3], [3]])

    def test_compression(self):
        aspaths_str = "29222 3303 6453 34977 48427:20932 1299 6453 34977 48427:12350 174 6453 34977 48427:15547 3356 6453 34977 48427:25091 1299 6453 34977 48427:2914 6453 34977 48427:14061 6453 34977 48427:19151 174 6453 34977 48427:7575 6461 6453 34977 48427:14907 2914 6453 34977 48427:2497 6453 34977 48427:7195 13786 6453 34977 48427:1280 6453 34977 48427:13030 1299 6453 34977 48427:6762 6453 34977 48427:19151 2914 6453 34977 48427:11039 6461 6453 34977 48427:16552 6453 34977 48427:37468 1299 6453 34977 48427:293 6453 34977 48427:2914 6453 34977 48427:6830 6453 34977 48427:19151 174 6453 34977 48427:5769 6453 34977 48427:41095 3356 6453 34977 48427:6079 1299 6453 34977 48427:6939 34977 48427:57695 3223 2914 6453 34977 48427:52320 1299 6453 34977 48427:20080 2914 6453 34977 48427:51185 3356 6453 34977 48427:51185 3356 6453 34977 48427:9002 6453 34977 48427:24482 6453 34977 48427:9304 174 6453 34977 48427:2497 6453 34977 48427:397143 3257 6453 34977 48427:47692 6939 34977 48427:8220 1299 6453 34977 48427:51873 6939 34977 48427:42473 9002 6453 34977 48427:49605 3257 6453 34977 48427:196621 15576 3356 6453 34977 48427:198385 174 6453 34977 48427:8218 6461 6453 34977 48427:25091 1299 6453 34977 48427:20612 8758 8220 6453 34977 48427:20612 1836 174 6453 34977 48427:35369 2914 6453 34977 48427:3257 6453 34977 48427:6830 6453 34977 48427:47147 1299 6453 34977 48427:49515 174 6453 34977 48427:6667 3257 6453 34977 48427:9002 6453 34977 48427:8218 6461 6453 34977 48427:20764 174 6453 34977 48427:24482 6453 34977 48427:6720 1853 6939 34977 48427:13237 2914 6453 34977 48427:58299 6939 34977 48427:25227 9002 6453 34977 48427:9002 6453 34977 48427:20764 20485 6453 34977 48427:24482 6453 34977 48427:41722 9002 6453 34977 48427:28917 6762 6453 34977 48427:39821 9002 6453 34977 48427:41095 3356 6453 34977 48427:2895 3267 174 6453 34977 48427:51907 9002 6453 34977 48427:13786 6453 34977 48427:28186 7738 6453 34977 48427:28634 37468 3356 6453 34977 48427:29479 9002 6453 34977 48427:28634 37468 3356 6453 34977 48427:393950 6939 34977 48427:22548 6939 34977 48427:52863 3356 6453 34977 48427:59891 51395 6939 34977 48427:15547 1299 6453 34977 48427:48550 57118 29691 6830 6453 34977 48427:51184 6939 34977 48427:31424 3257 6453 34977 48427:58057 3303 6453 34977 48427:42861 174 6453 34977 48427:25091 1299 1299 6453 34977 48427:42473 2914 6453 34977 48427:28186 12956 6453 34977 48427:62167 174 6453 34977 48427:24482 6453 34977 48427:51786 15623 3303 6453 34977 48427:21232 6830 6453 34977 48427:24482 6453 34977 48427:47147 1299 6453 34977 48427:64271 62240 1299 6453 34977 48427:23106 174 6453 34977 48427:51184 6939 34977 48427:14630 6453 34977 48427:8758 8220 6453 34977 48427:52873 12956 6453 34977 48427:202194 198385 174 6453 34977 48427:8607 2914 6453 34977 48427:2914 6453 34977 48427:15605 41327 1299 6453 34977 48427:12307 29691 6830 6453 34977 48427:13030 1299 6453 34977 48427:29691 6830 6453 34977 48427:286 6453 34977 48427:25160 174 6453 34977 48427:328145 9002 6453 34977 48427:59414 6830 6453 34977 48427:1103 286 6453 34977 48427:6908 1239 6453 34977 48427:31313 6830 6453 34977 48427:8455 3356 6453 34977 48427:205206 1299 6453 34977 48427:47692 6939 34977 48427:56430 12310 174 6453 34977 48427:47692 6939 34977 48427:64475 3320 6453 34977 48427:42861 174 6453 34977 48427:8218 6461 6453 34977 48427:29686 6453 34977 48427:24961 3320 6453 34977 48427:3491 6453 34977 48427:37497 174 6453 34977 48427:37239 37468 174 6453 34977 48427:37468 174 6453 34977 48427:57695 35487 328383 327782 37100 6453 34977 48427:37271 6453 34977 48427:57111 174 6453 34977 48427:5602 6762 6453 34977 48427:51185 6762 6453 34977 48427:49605 3257 6453 34977 48427:24482 6453 34977 48427:50877 6762 6453 34977 48427:8660 1267 3356 6453 34977 48427:5396 3257 6453 34977 48427:5392 3356 6453 34977 48427:12779 2914 6453 34977 48427:12637 3257 6453 34977 48427:20811 2914 6453 34977 48427:41327 1299 6453 34977 48427:20912 3257 6453 34977 48427:553 1299 6453 34977 48427:6762 6453 34977 48427:680 1299 1299 6453 34977 48427:57695 3223 2914 6453 34977 48427:6908 2914 6453 34977 48427:2914 6453 34977 48427:24482 6453 34977 48427:48919 6939 34977 48427:51184 6939 34977 48427:29467 2914 6453 34977 48427:6453 34977 48427:8283 6453 34977 48427:42541 3356 6453 34977 48427:50673 174 6453 34977 48427:24482 6453 34977 48427:47147 1299 6453 34977 48427:24875 3257 6453 34977 48427:6908 2914 6453 34977 48427:209650 209844 56381 3257 6453 34977 48427:3280 39737 1299 6453 34977 48427:14907 3320 6453 34977 48427:12859 2914 6453 34977 48427:8218 6461 6453 34977 48427:60501 57264 174 6453 34977 48427:64271 3214 3257 6453 34977 48427:51185 3356 6453 34977 48427:213382 34872 39533 6453 34977 48427:51088 6453 34977 48427:199938 201709 6805 12956 6453 34977 48427:30132 6453 34977 48427:59605 6453 34977 48427:15435 3257 6453 34977 48427:62167 3356 6453 34977 48427:8896 6453 34977 48427:7489 62240 1299 6453 34977 48427:12779 2914 6453 34977 48427:24482 6453 34977 48427:60501 57264 174 6453 34977 48427:39122 174 6453 34977 48427:207044 3356 6453 34977 48427:57695 58313 25369 174 6453 34977 48427:1299 6453 34977 48427:60945 1299 6453 34977 48427:58057 39533 6453 34977 48427:51185 3356 6453 34977 48427:8218 6461 6453 34977 48427:6894 174 6453 34977 48427:6908 1239 6453 34977 48427:31742 174 6453 34977 48427:35266 2914 6453 34977 48427:267613 174 6453 34977 48427:263152 28329 3356 6453 34977 48427:57695 262287 16735 3356 6453 34977 48427:1916 174 6453 34977 48427:34288 1299 6453 34977 48427:20811 3356 6453 34977 48427:25220 2914 6453 34977 48427:205112 50629 2914 6453 34977 48427:29140 286 6453 34977 48427:60501 57264 174 6453 34977 48427:51185 174 6453 34977 48427:47147 1299 6453 34977 48427:206356 50629 2914 6453 34977 48427:58057 39533 6453 34977 48427:49697 39912 1299 6453 34977 48427:47950 1299 6453 34977 48427:34927 58299 6939 34977 48427:39533 6453 34977 48427:16735 3356 6453 34977 48427:64271 262287 16735 3356 6453 34977 48427:53070 2914 6453 34977 48427:28260 12956 6453 34977 48427:23106 174 6453 34977 48427:262757 4230 6453 34977 48427:14907 2914 6453 34977 48427:18106 6939 34977 48427:63956 1299 6453 34977 48427:29680 15704 34977 48427:43578 1299 6453 34977 48427:267613 174 6453 34977 48427:268430 262403 52320 1299 6453 34977 48427:52720 52873 12956 6453 34977 48427:52320 1299 6453 34977 48427:42275 25091 43833 6939 34977 48427:49434 174 6453 34977 48427:16552 6453 34977 48427:35600 30781 2914 6453 34977 48427:55222 6939 34977 48427:2497 6453 34977 48427:19653 3356 6453 34977 48427:16552 6453 34977 48427:25152 6939 34977 48427:4777 2516 1299 6453 34977 48427:13030 1299 6453 34977 48427:61832 2914 6453 34977 48427:4739 7545 6453 34977 48427:34224 6453 34977 48427:61832 12956 6453 34977 48427:53767 3257 6453 34977 48427:37100 6453 34977 48427:28260 12956 6453 34977 48427:16552 22356 3491 6453 34977 48427:266437 28329 3356 6453 34977 48427:28186 12956 6453 34977 48427:28329 3356 6453 34977 48427:6423 209 6453 34977 48427:52863 3356 6453 34977 48427:1916 174 6453 34977 48427:1798 174 6453 34977 48427:262757 4230 6453 34977 48427:6939 34977 48427:131477 138576 3257 6453 34977 48427:55720 2914 6453 34977 48427:64271 131477 6939 34977 48427:50628 6453 34977 48427:48821 50629 2914 6453 34977 48427:49134 53356 6939 34977 48427:38726 6939 34977 48427:58511 1299 6453 34977 48427:58511 1299 6453 34977 48427:45177 4637 6453 34977 48427:34288 1299 6453 34977 48427:42541 3356 6453 34977 48427:2914 6453 34977 48427:39120 3356 6453 34977 48427:61568 6762 6453 34977 48427:58511 3257 6453 34977 48427:58511 1299 6453 34977 48427:58511 1299 6453 34977 48427:24482 6453 34977 48427:58511 3257 6453 34977 48427:58511 1299 6453 34977 48427:56665 6453 34977 48427:133950 9790 4826 6939 34977 48427:63956 1299 6453 34977 48427:36236 3356 6453 34977 48427:19754 1299 6453 34977 48427:59469 1299 6453 34977 48427:3267 174 6453 34977 48427:204028 6830 6453 34977 48427:2518 6453 34977 48427:1351 6939 34977 48427:38883 6939 34977 48427:1299 6453 34977 48427:38726 9957 2914 6453 34977 48427:52320 1299 6453 34977 48427:267613 1299 6453 34977 48427:27678 27986 12956 6453 34977 48427:26073 6939 34977 48427:32354 174 6453 34977 48427:14061 6453 34977 48427:19653 3356 6453 34977 48427:395570 6939 34977 48427:19151 209 6453 34977 48427:16552 6453 34977 48427:19016 3257 6453 34977 48427:293 6453 34977 48427:53828 2914 6453 34977 48427:32709 6939 34977 48427:14630 3356 6453 34977 48427:852 6453 34977 48427:14630 1299 6453 34977 48427:52320 1299 6453 34977 48427:6939 34977 48427:52871 6762 6453 34977 48427:268976 4809 12956 6453 34977 48427:267613 174 6453 34977 48427:57695 262287 16735 3356 6453 34977 48427:37468 3356 6453 34977 48427:52873 12956 6453 34977 48427:263009 3356 6453 34977 48427:19151 174 6453 34977 48427:2497 6453 34977 48427:7575 6461 6453 34977 48427:6939 34977 48427:36351 7018 6453 34977 48427:14361 3257 6453 34977 48427:24482 6453 34977 48427:24516 1299 6453 34977 48427:14061 6453 34977 48427:8220 6453 34977 48427:137831 4657 6453 34977 48427:58511 1299 6453 34977 48427:17639 1299 6453 34977 48427:7713 6453 34977 48427:7713 6453 34977 48427:137831 3491 6453 34977 48427:3491 6453 34977 48427:63956 1299 6453 34977 48427:18106 6939 34977 48427:41157 29075 6453 34977 48427:50628 6453 34977 48427:2497 6453 34977 48427:202365 50673 174 6453 34977 48427:3257 6453 34977 48427:42541 3356 6453 34977 48427:46450 2914 6453 34977 48427:61568 6762 6453 34977 48427:39351 174 6453 34977 48427:45352 174 6453 34977 48427:38001 3491 6453 34977 48427:40630 6939 34977 48427:14840 6762 6453 34977 48427:63927 3491 6453 34977 48427:29479 9002 6453 34977 48427:3292 6453 34977 48427:6939 34977 48427:23367 6461 6453 34977 48427:3561 209 6453 34977 48427:23367 6461 6453 34977 48427:286 6453 34977 48427:5650 7018 6453 34977 48427:209 6453 34977 48427:209 6453 34977 48427:209 6453 34977 48427:40387 174 6453 34977 48427:5645 1299 6453 34977 48427:58308 29075 6453 34977 48427:8218 6461 6453 34977 48427:8218 6461 6453 34977 48427:57866 2914 6453 34977 48427:328145 9002 6453 34977 48427:3491 6453 34977 48427:37497 174 6453 34977 48427:22652 6453 34977 48427:37468 174 6453 34977 48427:20912 3257 6453 34977 48427:3741 3356 6453 34977 48427:5413 1299 6453 34977 48427:7018 6453 34977 48427:3257 6453 34977 48427:8492 9002 6453 34977 48427:31019 39326 1299 6453 34977 48427:49788 174 6453 34977 48427:1299 6453 34977 48427:701 6453 34977 48427:11686 6461 6453 34977 48427:18106 6939 34977 48427:54728 20130 6939 34977 48427:23673 3491 6453 34977 48427:3130 2914 6453 34977 48427:3130 2914 6453 34977 48427:1403 6453 34977 48427:1403 6453 34977 48427:293 6453 34977 48427:3549 3356 6453 34977 48427:852 6453 34977 48427:3277 3267 174 6453 34977 48427:24441 3491 3491 6453 34977 48427:2914 6453 34977 48427:55720 3491 6453 34977 48427:11708 32097 6939 34977 48427:3280 39737 1299 6453 34977 48427:328474 328474 328474 328474 328112 37100 6453 34977 48427:7018 6453 34977 48427:174 6453 34977 48427:58057 174 6453 34977 48427:35619 60474 58057 174 6453 34977 48427:49752 58299 6939 34977 48427:852 6453 34977 48427:13830 29802 6939 34977 48427:19151 174 6453 34977 48427:37721 1299 6453 34977 48427:15562 2914 6453 34977 48427:50300 3257 6453 34977 48427:207564 28824 8896 6453 34977 48427:29504 15935 174 6453 34977 48427:49432 48362 3356 6453 34977 48427:139589 58299 6939 34977 48427:208210 39533 6453 34977 48427:395152 395152 395152 6939 34977 48427:3333 1257 6453 34977 48427:39351 174 6453 34977 48427:44977 49752 58299 6939 34977 48427:57381 42708 1299 6453 34977 48427:34681 206499 50629 2914 6453 34977 48427:34872 39533 6453 34977 48427:34800 58057 174 6453 34977 48427:6881 15685 6939 34977 48427:1403 6453 34977 48427:34854 1299 6453 34977 48427:17639 6453 34977 48427:4608 1221 4637 6453 34977 48427:37989 4844 2914 6453 34977 48427:3549 3356 6453 34977 48427:14907 6461 6453 34977 48427:8758 8220 6453 34977 48427:20514 2119 6453 34977 48427:26073 6939 34977 48427:208709 34872 39533 6453 34977 48427:208210 39533 6453 34977 48427:50304 1299 6453 34977 48427:132825 2914 6453 34977 48427:58057 34549 1299 6453 34977 48427:47251 48362 3356 6453 34977 48427:209152 58299 6939 34977 48427:208709 34872 39533 6453 34977 48427:61955 174 6453 34977 48427:13030 1299 6453 34977 48427:13030 1299 6453 34977 48427:6830 6453 34977 48427:267613 1299 6453 34977 48427:14537 6453 34977 48427:39122 174 6453 34977 48427:16552 6453 34977 48427:5413 1299 6453 34977 48427:6453 34977 48427:6667 1299 6453 34977 48427:37497 174 6453 34977 48427:59605 6453 34977 48427:5413 1299 6453 34977 48427:8426 34977 48427:37271 6453 34977 48427:6939 34977 48427:58511 3257 6453 34977 48427:2914 6453 34977 48427:8455 3356 6453 34977 48427:41811 3356 6453 34977 48427:34288 1299 6453 34977 48427:13237 3257 6453 34977 48427:14061 2914 6453 34977 48427:41695 174 6453 34977 48427:37271 6453 34977 48427:3491 6453 34977 48427:6830 6453 34977 48427:14061 2914 6453 34977 48427:58511 3257 6453 34977 48427:6667 1299 6453 34977 48427:58511 1299 6453 34977 48427:1239 6453 34977 48427:286 6453 34977 48427:2152 3356 6453 34977 48427:6939 34977 48427:3549 3356 6453 34977 48427:2497 6453 34977 48427:3561 209 6453 34977 48427:1221 4637 6453 34977 48427:3303 6453 34977 48427:7660 2516 1299 6453 34977 48427:198290 2914 6453 34977 48427:51405 206610 1299 6453 34977 48427:204355 174 6453 34977 48427:15547 3356 6453 34977 48427:58308 29075 6453 34977 48427:12779 2914 6453 34977 48427:59689 30781 3356 6453 34977 48427:20766 6453 34977 48427:29075 6453 34977 48427:24482 6453 34977 48427:2613 6893 6730 174 6453 34977 48427:57199 50628 6453 34977 48427:34177 3356 6453 34977 48427:16347 3356 6453 34977 48427:8426 34977 48427:205344 50628 6453 34977 48427:204708 20766 6453 34977 48427:39533 4134 6453 34977 48427:56665 6453 34977 48427:25091 43833 6939 34977 48427:7500 2497 6453 34977 48427:58511 1299 6453 34977 48427:7575 2914 6453 34977 48427:3491 6453 34977 48427:24516 1299 6453 34977 48427:4826 6939 34977 48427:28571 1916 174 6453 34977 48427:51088 6453 34977 48427:24875 3257 6453 34977 48427:39591 174 6453 34977 48427:267613 1299 6453 34977 48427:5394 3257 6453 34977 48427:16552 6453 34977 48427:6830 6453 34977 48427:31019 39326 1299 6453 34977 48427:39120 3356 6453 34977 48427:293 6453 34977 48427:12859 2914 6453 34977 48427:20953 174 6453 34977 48427:1103 3257 6453 34977 48427:58511 3257 6453 34977 48427:34968 8455 3356 6453 34977 48427:12779 2914 6453 34977 48427:1103 286 6453 34977 48427:6939 34977 48427:6082 2914 6453 34977 48427:27446 27446 6939 34977 48427:4181 1299 6453 34977 48427:53828 2914 6453 34977 48427:15008 174 6453 34977 48427:3491 6453 34977 48427:22652 6453 34977 48427:59919 28716 2914 6453 34977 48427:202365 50673 174 6453 34977 48427:20205 6939 34977 48427:32097 6939 34977 48427:57199 50628 6453 34977 48427:34549 1299 6453 34977 48427:204092 174 6453 34977 48427:49420 34209 3257 6453 34977 48427:49102 9002 6453 34977 48427:205148 9002 6453 34977 48427:60371 58057 39533 6453 34977 48427:43607 58057 39533 6453 34977 48427:49673 48858 20485 6453 34977 48427:48362 3356 6453 34977 48427:48362 3356 6453 34977 48427:48362 9002 6453 34977 48427:"
        compressed = compress_aspaths_str(aspaths_str)
        decompressed = decompress_aspaths_str(compressed)
        size1 = sys.getsizeof(aspaths_str)
        size2 = sys.getsizeof(aspaths_from_str(aspaths_str))
        size3 = sys.getsizeof(compressed)
        self.assertEqual(aspaths_str, decompressed)
        self.assertEqual(aspaths_from_str(aspaths_str), aspaths_from_str(decompressed))